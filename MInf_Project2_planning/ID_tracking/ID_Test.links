import IdTestLib;

##Client

fun clientLoop() {
  receive {

    case NewCallClient() ->
      print("new Call Client");
      var id = IdTestLib.startClient();
      print("Call Client with ID: " ^^ intToString(id) ^^ " created");
      clientLoop()
  }
}

fun mainPage() {

  var clientPid = spawnClient {clientLoop()};

  page
    <html>
      <button type="submit" l:onclick="{clientPid ! NewCallClient()}">Produce Client</button>
      <div id = "info">
      </div>
    </html>
}

fun main() {
    # Spawns a process on the server which keeps track of all clients
    # Registers the "mainPage" route
    addRoute("/", fun(_) { mainPage() });
    # Starts the server and distribution
    serveWebsockets();
    servePages()
}


main()
